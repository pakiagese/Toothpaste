<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Toothpaste Detection</title>
</head>
<body>
    <canvas id="canvas" width="640" height="480"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.onload = function() {
            ctx.drawImage(img, 0, 0);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            // Simple grayscale conversion
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = data[i + 1] = data[i + 2] = avg;
            }
            // Sobel edge detection kernel (basic horizontal and vertical)
            const sobelX = [-1, 0, 1, -2, 0, 2, -1, 0, 1];
            const sobelY = [-1, -2, -1, 0, 0, 0, 1, 2, 1];
            // Apply Sobel (simplified for demo; full impl would convolve)
            for (let y = 1; y < canvas.height - 1; y++) {
                for (let x = 1; x < canvas.width - 1; x++) {
                    const idx = (y * canvas.width + x) * 4;
                    let gx = 0, gy = 0;
                    // Convolve 3x3 neighborhood (indices flattened)
                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const nIdx = ((y + ky) * canvas.width + (x + kx)) * 4;
                            const gray = data[nIdx] / 255;
                            gx += gray * sobelX[(ky + 1) * 3 + (kx + 1)];
                            gy += gray * sobelY[(ky + 1) * 3 + (kx + 1)];
                        }
                    }
                    const magnitude = Math.sqrt(gx * gx + gy * gy);
                    data[idx] = data[idx + 1] = data[idx + 2] = magnitude * 255;
                }
            }
            ctx.putImageData(imageData, 0, 0);
            // Basic rectangle detection (threshold edges and find contours)
            const threshold = 100;
            let contours = []; // Simplified: group high-edge pixels into rectangles
            for (let y = 0; y < canvas.height; y += 10) {
                for (let x = 0; x < canvas.width; x += 10) {
                    const idx = (y * canvas.width + x) * 4;
                    if (data[idx] > threshold) {
                        contours.push({x, y, w: 50, h: 100}); // Mock rectangle for toothpaste tube
                    }
                }
            }
            // Draw detected rectangles
            ctx.strokeStyle = 'red';
            contours.forEach(c => {
                ctx.strokeRect(c.x, c.y, c.w, c.h);
            });
            console.log(`Detected ${contours.length} potential toothpaste tubes.`);
        };
        img.src = 'path/to/your/image.jpg'; // Replace with image URL
    </script>
</body>
</html>